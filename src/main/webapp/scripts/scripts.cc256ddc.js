"use strict";angular.module("unoApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ui.router","LocalStorageModule"]).config(["$httpProvider",function(a){a.interceptors.push(["$rootScope",function(a){return a.isLoading=0,{request:function(b){return a.isLoading++,b},requestError:function(b){return a.isLoading=Math.max(0,a.isLoading-1),b},response:function(b){return a.isLoading=Math.max(0,a.isLoading-1),b},responseError:function(b){return a.isLoading=Math.max(0,a.isLoading-1),b}}}])}]).config(["localStorageServiceProvider",function(a){a.setStorageType("sessionStorage")}]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginController"}).state("register",{url:"/register",templateUrl:"views/register.html",controller:"RegisterController"}).state("app",{url:"/app","abstract":!0,templateUrl:"views/app.html",controller:"AppController"}).state("app.home",{url:"/home",templateUrl:"views/home.html",controller:"HomeController",resolve:{Games:["$http","$q",function(a,b){var c=b.defer();return a.get("/rest/game").then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise}]}}).state("app.start",{url:"/start",templateUrl:"views/start.html",controller:"StartController"}).state("app.room",{url:"/room/:name",templateUrl:"views/room.html",controller:"RoomController"}).state("app.game",{url:"/game/:name",templateUrl:"views/game.html",controller:"GameController"}),b.otherwise("/login")}]),angular.module("unoApp").controller("AppController",["$rootScope","$scope","$state","Auth",function(a,b,c,d){d.isConnected()?b.user=d.getUser():c.go("login"),b.goLogout=function(){d.destroyUser(),c.go("login")}}]),angular.module("unoApp").controller("GameController",["$rootScope","$scope","$http","$stateParams",function(a,b,c,d){c.get("/rest/game/"+d.name+"/"+b.user.name).then(function(a){b.cartes=a.data.cartes,console.log(b.cartes)},function(a){b.error="Une erreur est survenue : "+a.toString()}),c.get("/rest/game/"+d.name).then(function(a){console.log(a.data)},function(a){console.error(a)}),b.piocherCarte=function(){b.cartes.push(b.cartes[b.cartes.length%8])},b.jouerCarte=function(a){b.cartes.splice(b.cartes.indexOf(a),1),b.fausse=a}}]),angular.module("unoApp").controller("HomeController",["$scope","$timeout","$http","$state","Games",function(a,b,c,d,e){a.games=e.data.games;var f;a.requestListGames=function(){f=b(function(){c.get("/rest/game/").then(function(b){a.games=b.data.games,a.requestListGames()},function(b){console.error(b),a.requestListGames()})},5e3)},a.requestListGames(),a.joinGame=function(b){c.put("/rest/game/"+b,{playerName:a.user.name},{headers:{token:a.user.token}}).then(function(a){switch(a.status){case 200:a.data.status?d.go("app.room",{name:b}):console.error("MyError 1 : ",a);break;default:console.error("MyError 2 : ",a)}},function(a){console.error(a)})},a.$on("$destroy",function(){b.cancel(f)})}]),angular.module("unoApp").controller("StartController",["$rootScope","$scope","$state","$http",function(a,b,c,d){b.nbPlayers=2,b.goGame=function(){b.game&&b.game.length>3&&b.user.name?d.post("/rest/game",{game:b.game,player:b.user.name,numberplayers:b.nbPlayers},{headers:{token:b.user.token}}).then(function(a){switch(a.status){case 200:c.go("app.room",{name:b.game});break;default:b.error=a.error}},function(a){b.error="Une erreur est survenue : "+a}):b.error="3 caractères minimum est requis pour le nom de la partie"}}]),angular.module("unoApp").controller("LoginController",["$rootScope","$scope","$state","Auth",function(a,b,c,d){d.isConnected()&&c.go("app.home"),b.goLogin=function(){window.alert("Log in not available !")},b.goLoginGuess=function(){var a="Anonyme"+Math.floor(999*Math.random()+1);d.setUser(a).then(function(b){b.name=a,d.connectUser(b),c.go("app.home")})}}]),angular.module("unoApp").controller("RegisterController",["$rootScope","$scope","$state","Auth",function(a,b,c,d){d.isConnected()&&c.go("app.home"),b.goRegister=function(){window.alert("Register not available !")}}]),angular.module("unoApp").controller("RoomController",["$rootScope","$scope","$state","$stateParams","$http","$timeout",function(a,b,c,d,e,f){b.gameName=d.name;var g;e.get("/rest/game/"+b.gameName).then(function(a){b.game=a.data,b.requestStateGame()},function(a){console.error(a),b.requestStateGame()}),b.requestStateGame=function(){g=f(function(){e.get("/rest/game/"+b.gameName).then(function(a){b.game=a.data,b.game.state?c.go("app.game",{name:b.gameName}):b.requestStateGame()},function(a){console.error(a),b.requestStateGame()})},5e3)},b.startGameNow=function(){e.put("/rest/game/"+b.gameName+"/command",{playerName:b.user.name}).then(function(a){switch(a.status){case 200:a.data.status?c.go("app.game",{name:b.gameName}):console.error(a);break;default:console.error(a)}},function(a){console.error(a)})},b.$on("$destroy",function(){f.cancel(g)})}]),angular.module("unoApp").service("Auth",["localStorageService","$http","$q",function(a,b,c){return{getUser:function(){return a.get("user")},setUser:function(a){var d=c.defer();return b.post("/rest/auth",{playername:a}).then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise},connectUser:function(b){a.set("user",b)},isConnected:function(){return!!a.get("user")},destroyUser:function(){a.remove("user")}}}]),angular.module("unoApp").run(["$templateCache",function(a){a.put("views/app.html",'<header data-ng-include="\'views/struct/header.html\'"></header> <div id="game" class="container-fluid" data-ui-view=""></div> <!--<footer data-ng-include="\'views/struct/footer.html\'"></footer>-->'),a.put("views/game.html",'<div id="table-game"> <!--<div id="pioche" data-ng-click="piocherCarte()"></div>--> <!--<div id="fausse" class="carte {{fausse.famille}}-{{fausse.nombre}}"></div>--> </div> <div id="main"> <ul> <li data-ng-repeat="carte in cartes track by $index" data-ng-click="jouerCarte(carte)" class="carte {{carte.familly}}-{{carte.number}}"></li> </ul> </div>'),a.put("views/home.html",'<div class="jumbotron"> <button class="btn btn-success" id="ingage" data-ui-sref="app.start"> Start new game </button> </div> <div class="col-md-8 col-md-offset-2"> <div class="panel panel-default"> <div class="panel-heading text-center">All games</div> <div class="panel-body text-center" style="padding:0"> <table class="table" data-ng-if="games.length > 0" style="margin: 0"> <tr data-ng-repeat="game in games"> <td>{{game.gamename}}</td> <td>{{game.numberplayer}}/{{game.maxplayer}}</td> <td>{{(game.numberplayer == game.maxplayer) ? "Started" : "Waiting for Players"}}</td> <td> <button class="btn btn-warning btn-sm" data-ng-if="game.numberplayer != game.maxplayer" data-ng-click="joinGame(game.gamename)"> Join </button> </td> </tr> </table> <p style="padding: 15px" data-ng-if="games.length == 0">There is no started games yet</p> </div> </div> </div> <!--\n<div class="col-md-6">\n    <div class="panel panel-default">\n        <div class="panel-heading text-center">My games</div>\n        <div class="panel-body text-center" style="padding:0;">\n            <table class="table" data-ng-if="games.length > 0" style="margin: 0;">\n                <tr data-ng-repeat="game in games">\n                    <td>{{game.gamename}}</td>\n                    <td>{{game.numberplayer}}/{{game.maxplayer}}</td>\n                    <td>{{(game.numberplayer == game.maxplayer) ? "Started" : "Waiting for Players"}}</td>\n                    <td>\n                        <button class="btn btn-warning btn-sm"\n                                data-ng-if="game.numberplayer != game.maxplayer"\n                                data-ng-click="joinGame(game.gamename)">\n                            Join\n                        </button>\n                    </td>\n                </tr>\n            </table>\n            <p style="padding: 15px;" data-ng-if="games.length == 0">There is no started games yet</p>\n        </div>\n    </div>\n</div>\n-->'),a.put("views/login.html",'<div id="login" class="container"> <div class="col-md-12 text-center"> <h1 class="title-uno"> <span class="color-orange">U</span><span class="color-rouge">N</span><span class="color-vert">O</span> </h1> <br> <div class="col-md-6"> <div class="panel panel-default" style="height: 305px"> <div class="panel-heading">Login</div> <div class="panel-body"> <form method="post" class="form-horizontal" data-ng-submit="goLogin()"> <div class="form-group"> <input class="input-form input-lg" type="email" placeholder="Email" id="email" data-ng-model="email"> </div> <div class="form-group"> <input class="input-form input-lg" type="password" placeholder="Password" id="pass" data-ng-model="pass"> </div> <br> <button type="submit" class="btn btn-lg btn-success">Login</button> </form> </div> </div> <br> </div> <div class="col-md-6"> <div class="panel panel-default" style="height: 305px"> <div class="panel-heading">- OR -</div> <div class="panel-body"> <br> <br> <button data-ng-click="goLoginGuess();" style="font-size: 26pt" class="btn btn-lg btn-success">Connect Guest</button> <br> <br> </div> </div> </div> <div class="col-md-12"> <p> <span class="hidden-sm hidden-md hidden-lg"> <br> <br> </span> You don\'t have an account ? <br> <button class="btn btn-danger" data-ui-sref="register">Register</button> </p> </div> </div> </div>'),a.put("views/register.html",'<div id="register" class="container"> <div class="col-md-offset-3 col-md-6 text-center"> <h1 class="title-uno"> <span class="color-orange">U</span><span class="color-rouge">N</span><span class="color-vert">O</span> </h1> <br> <div class="col-md-12"> <div class="panel panel-default"> <div class="panel-heading">Register</div> <div class="panel-body"> <form method="post" class="form-horizontal" data-ng-submit="goRegister()"> <div class="form-group"> <input class="input-form input-lg" type="text" placeholder="Prénom" id="prenom" data-ng-model="prenom"> </div> <div class="form-group"> <input class="input-form input-lg" type="email" placeholder="Email" id="email" data-ng-model="email"> </div> <div class="form-group"> <input class="input-form input-lg" type="password" placeholder="Password" id="pass" data-ng-model="pass"> </div> <br> <button type="submit" class="btn btn-lg btn-success">Register</button> </form> </div> </div> </div> <br> <p> You already have an account ? <br> <button class="btn btn-danger" data-ui-sref="login">Login</button> </p> </div> </div>'),a.put("views/room.html",'<div class="col-md-12 text-center" style="padding-bottom: 15px"> <h1 class="title">Room {{gameName}}</h1> <br> <button data-ng-if="game.players.length == game.maxplayers && game.host == user.name" class="btn btn-success btn-lg" data-ng-click="startGameNow()">Start game now</button> <br> </div> <div class="col-md-10 col-md-offset-1"> <div class="panel panel-default"> <div class="panel-heading"> Waiting for players... <span style="float: right">{{game.players.length}}/{{game.maxplayers}} joined</span> </div> <div class="panel-body" style="padding: 0"> <table class="table"> <tr data-ng-repeat="player in game.players"> <td width="15"> <i data-ng-if="game.host == player.name" class="fa fa-bookmark-o" style="color: #f55; font-weight: bolder"></i> <i data-ng-if="game.host != player.name" class="fa fa-child" style="color: #fa0"></i> </td> <td class="text-center">{{player.name}} join the game</td> </tr> </table> </div> </div> </div>'),a.put("views/start.html",'<div id="start" class="container"> <div class="col-md-offset-3 col-md-6 text-center"> <div data-ng-if="error" class="alert alert-danger"> {{error}} </div> <h1 class="title-uno">Configuration</h1> <br> <form class="form-horizontal" data-ng-submit="goGame()"> <div class="form-group"> <input id="username" class="input-form input-lg" type="text" data-ng-model="game" placeholder="Game name"> </div> <div class="form-group"> <select class="input-form input-lg col-md-6 col-md-offset-3" name="nbPlayers" value="{{nbPlayers}}" data-ng-model="nbPlayers" id="nbPlayers"> <option value="2" selected>2</option> <option value="3">3</option> <option value="4">4</option> <option value="5">5</option> <option value="6">6</option> </select> </div> <button type="submit" class="btn btn-lg btn-success" style="font-size: 24pt">GO !</button> </form> <br> </div> </div>'),a.put("views/struct/footer.html","<span> By LP SIL IDSE </span>"),a.put("views/struct/header.html",'<nav class="navbar"> <div class="container-fluid"> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-toggle" aria-expanded="false"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href data-ui-sref="app.home"> <span class="color-orange">U</span><span class="color-rouge">N</span><span class="color-vert">O</span> </a> </div> <div class="collapse navbar-collapse" id="navbar-toggle"> <ul class="nav navbar-nav navbar-right"> <li> {{user.name}} </li> <li> <a href data-ng-click="goLogout()"> <i class="fa fa-sign-out"></i> </a> </li> </ul> </div> </div> </nav>')}]);