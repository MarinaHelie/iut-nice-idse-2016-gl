"use strict";angular.module("unoApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ui.router","LocalStorageModule"]).config(["$httpProvider",function(a){a.interceptors.push(["$rootScope",function(a){return a.isLoading=0,{request:function(b){return a.isLoading++,b},requestError:function(b){return a.isLoading=Math.max(0,a.isLoading-1),b},response:function(b){return a.isLoading=Math.max(0,a.isLoading-1),b},responseError:function(b){return a.isLoading=Math.max(0,a.isLoading-1),b}}}])}]).config(["localStorageServiceProvider",function(a){a.setStorageType("sessionStorage")}]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginController"}).state("register",{url:"/register",templateUrl:"views/register.html",controller:"RegisterController"}).state("app",{url:"/app","abstract":!0,templateUrl:"views/app.html",controller:"AppController"}).state("app.home",{url:"/home",templateUrl:"views/home.html",controller:"HomeController",resolve:{Games:["$http","$q",function(a,b){var c=b.defer();return a.get("/rest/game").then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise}]}}).state("app.start",{url:"/start",templateUrl:"views/start.html",controller:"StartController"}).state("app.room",{url:"/room/:name",templateUrl:"views/room.html",controller:"RoomController"}).state("app.game",{url:"/game/:name",templateUrl:"views/game.html",controller:"GameController"}),b.otherwise("/login")}]),angular.module("unoApp").controller("AppController",["$rootScope","$scope","$state","Auth",function(a,b,c,d){d.isConnected()?b.user=d.getUser():c.go("login"),b.goLogout=function(){d.destroyUser(),c.go("login")}}]),angular.module("unoApp").controller("GameController",["$rootScope","$scope","$http","$stateParams","$timeout","Game",function(a,b,c,d,e,f){var g;f.getUserHand(d.name,b.user.name).then(function(a){b.cartes=a.data.cartes},function(a){console.error("Une erreur est survenue : "+a.toString())}),f.getGame(d.name).then(function(a){b.game=a.data,b.requestStateGame()},function(a){console.error("Une erreur est survenue : "+a.toString()),b.requestStateGame()}),b.requestStateGame=function(){g=e(function(){f.getGame(d.name).then(function(a){b.game=a.data,c.get("/rest/game/"+d.name+"/command").then(function(a){a.data.playerName===b.user.name&&console.log("à moi de jouer !")},function(a){console.error(a)}),b.requestStateGame(),c.get("/rest/game/"+d.name+"/"+b.user.name).then(function(a){b.cartes=a.data.cartes},function(a){console.error("Une erreur est survenue : "+a.toString())})},function(a){console.error("Une erreur est survenue : "+a.toString()),b.requestStateGame()})},2e3)},b.piocherCarte=function(){c.post("/rest/game/"+d.name+"/"+b.user.name,{}).then(function(){c.get("/rest/game/"+d.name+"/"+b.user.name).then(function(a){b.cartes=a.data.cartes},function(a){console.error("Une erreur est survenue : "+a.toString())})},function(a){console.error(a)})},b.jouerCarte=function(a){c.put("/rest/game/"+d.name+"/"+b.user.name,{value:a.number,color:a.familly}).then(function(a){console.log(a),c.get("/rest/game/"+d.name+"/"+b.user.name).then(function(a){b.cartes=a.data.cartes},function(a){console.error("Une erreur est survenue : "+a.toString())}),c.get("/rest/game/"+d.name).then(function(a){b.game=a.data},function(a){console.error("Une erreur est survenue : "+a.toString())})},function(a){console.error(a)})},b.$on("$destroy",function(){e.cancel(g)})}]),angular.module("unoApp").controller("HomeController",["$scope","$timeout","$http","$state","Games","Game",function(a,b,c,d,e,f){a.games=e.data.games;var g;a.requestListGames=function(){g=b(function(){f.getAllGames().then(function(b){a.games=b.data.games,a.requestListGames()},function(b){console.error(b),a.requestListGames()})},5e3)},a.requestListGames(),a.joinGame=function(a){f.joinGame(a).then(function(b){switch(b.status){case 200:b.data.status?d.go("app.room",{name:a}):console.error("MyError 1 : ",b);break;default:console.error("MyError 2 : ",b)}},function(a){console.error(a)})},a.$on("$destroy",function(){b.cancel(g)})}]),angular.module("unoApp").controller("StartController",["$rootScope","$scope","$state","$http","Game",function(a,b,c,d,e){b.nbPlayers="2",b.goGame=function(){b.game&&b.game.length>3&&b.user.name?e.createGame(b.game,b.nbPlayers).then(function(a){switch(a.status){case 200:c.go("app.room",{name:b.game});break;default:b.error=a.error}},function(a){b.error="Une erreur est survenue : "+a}):b.error="3 caractères minimum est requis pour le nom de la partie"}}]),angular.module("unoApp").controller("LoginController",["$rootScope","$scope","$state","Auth",function(a,b,c,d){d.isConnected()&&c.go("app.home"),b.goLogin=function(){window.alert("Log in not available !")},b.goLoginGuess=function(){var a="Anonyme"+Math.floor(999*Math.random()+1);d.setUser(a).then(function(b){b.name=a,d.connectUser(b),c.go("app.home")})}}]),angular.module("unoApp").controller("RegisterController",["$rootScope","$scope","$state","Auth",function(a,b,c,d){d.isConnected()&&c.go("app.home"),b.goRegister=function(){window.alert("Register not available !")}}]),angular.module("unoApp").controller("RoomController",["$rootScope","$scope","$state","$stateParams","$http","$timeout",function(a,b,c,d,e,f){b.gameName=d.name;var g;e.get("/rest/game/"+b.gameName).then(function(a){b.game=a.data,b.requestStateGame()},function(a){console.error(a),b.requestStateGame()}),b.requestStateGame=function(){g=f(function(){e.get("/rest/game/"+b.gameName).then(function(a){b.game=a.data,b.game.state?c.go("app.game",{name:b.gameName}):b.requestStateGame()},function(a){console.error(a),b.requestStateGame()})},5e3)},b.startGameNow=function(){e.put("/rest/game/"+b.gameName+"/command",{playerName:b.user.name}).then(function(a){switch(a.status){case 200:a.data.status?c.go("app.game",{name:b.gameName}):console.error(a);break;default:console.error(a)}},function(a){console.error(a)})},b.$on("$destroy",function(){f.cancel(g)})}]),angular.module("unoApp").service("Auth",["localStorageService","$http","$q",function(a,b,c){return{getUser:function(){return a.get("user")},setUser:function(a){var d=c.defer();return b.post("/rest/auth",{playername:a}).then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise},connectUser:function(b){a.set("user",b)},isConnected:function(){return!!a.get("user")},destroyUser:function(){a.remove("user")},registerUser:function(a,d,e){var f=c.defer();return b.put("/rest/game/",{email:a,name:d,password:e}).then(function(a){console.log(a),f.resolve(a)},function(a){console.log(a),f.reject(a)}),f.promise}}}]),angular.module("unoApp").service("Game",["Auth","$http","$q",function(a,b,c){return{createGame:function(d,e){var f=c.defer();return b.post("/rest/game",{game:d,player:a.getUser().name,numberplayers:e},{headers:{token:a.getUser().token}}).then(function(a){console.log(a),f.resolve(a)},function(a){console.log(a),f.reject(a)}),f.promise},getGame:function(a){var d=c.defer();return b.get("/rest/game/"+a).then(function(a){console.log(a),d.resolve(a)},function(a){console.log(a),d.reject(a)}),d.promise},getAllGames:function(){var a=c.defer();return b.get("/rest/game").then(function(b){console.log(b),a.resolve(b)},function(b){console.log(b),a.reject(b)}),a.promise},getUserHand:function(a,d){var e=c.defer();return b.get("/rest/game/"+a+"/"+d).then(function(a){console.log(a),e.resolve(a)},function(a){console.log(a),e.reject(a)}),e.promise},joinGame:function(d){var e=c.defer();return b.put("/rest/game/"+d,{playerName:a.getUser().name},{headers:{token:a.getUser().token}}).then(function(a){console.log(a),e.resolve(a)},function(a){console.log(a),e.reject(a)}),e.promise}}}]),angular.module("unoApp").filter("WordToNumber",function(){var a={Zero:0,One:1,Two:2,Three:3,Four:4,Five:5,Six:6,Seven:7,Eight:8,Nine:9,Skip:10,Reverse:11,DrawTwo:12,Wild:13,DrawFour:14};return function(b){return a[b]}}),angular.module("unoApp").run(["$templateCache",function(a){a.put("views/app.html",'<header data-ng-include="\'views/struct/header.html\'"></header> <div id="game" class="container-fluid" data-ui-view=""></div> <!--<footer data-ng-include="\'views/struct/footer.html\'"></footer>-->'),a.put("views/game.html",'<div class="players"> <div data-ng-repeat="player in game.players" data-ng-if="player.name != user.name" class="text-center"> <span>{{player.name}}</span> <br> <span>{{player.cartes}} cartes</span> </div> </div> <div id="table-game"> <div id="pioche" data-ng-click="piocherCarte()"></div> <div id="fausse" class="carte {{game.stack.family}}-{{game.stack.number | WordToNumber}}"></div> </div> <div id="main"> <ul> <li data-ng-repeat="carte in cartes track by $index" data-ng-click="jouerCarte(carte)" class="carte {{carte.familly}}-{{carte.number | WordToNumber}}"></li> </ul> </div>'),a.put("views/home.html",'<div class="jumbotron"> <button class="btn btn-success" id="ingage" data-ui-sref="app.start"> Start new game </button> </div> <div class="col-md-8 col-md-offset-2"> <div class="panel panel-default"> <div class="panel-heading text-center">All games</div> <div class="panel-body text-center" style="padding:0"> <table class="table" data-ng-if="games.length > 0" style="margin: 0"> <tr data-ng-repeat="game in games"> <td>{{game.gamename}}</td> <td>{{game.numberplayer}}/{{game.maxplayer}}</td> <td>{{(game.state == "true") ? "Started" : ((game.numberplayer == game.maxplayer) ? "Full Players" : "Waiting for Players")}}</td> <td> <button class="btn btn-warning btn-sm" data-ng-if="game.numberplayer != game.maxplayer" data-ng-click="joinGame(game.gamename)"> Join </button> </td> </tr> </table> <p style="padding: 15px" data-ng-if="games.length == 0">There is no started games yet</p> </div> </div> </div> <!-- Mes parties en pause car pas encore défini la méthode.\n<div class="col-md-8 col-md-offset-2">\n    <div class="panel panel-default">\n        <div class="panel-heading text-center">My games</div>\n        <div class="panel-body text-center" style="padding:0;">\n            <table class="table" data-ng-if=" games.playerName == \'toto\' " style="margin: 0;">\n                <tr data-ng-repeat="game in games" >\n                    <td>{{game.gamename}}</td>\n                    <td>{{game.numberplayer}}/{{game.maxplayer}}</td>\n                    <td>{{(game.numberplayer == game.maxplayer) ? "Started" : "Waiting for Players"}}</td>\n                    <td>{{game.playerName}}</td>\n                </tr>\n            </table>\n            <p style="padding: 15px;" data-ng-if="games.playerName != \'toto\' ">No game with you as created</p>\n        </div>\n    </div>\n</div>-->'),a.put("views/login.html",'<div id="login" class="container"> <div class="col-md-12 text-center"> <h1 class="title-uno"> <span class="color-orange">U</span><span class="color-rouge">N</span><span class="color-vert">O</span> </h1> <br> <div class="col-md-6"> <div class="panel panel-default" style="height: 305px"> <div class="panel-heading">Login</div> <div class="panel-body"> <form method="post" class="form-horizontal" data-ng-submit="goLogin()"> <div class="form-group"> <input class="input-form input-lg" type="email" placeholder="Email" id="email" data-ng-model="email"> </div> <div class="form-group"> <input class="input-form input-lg" type="password" placeholder="Password" id="pass" data-ng-model="pass"> </div> <br> <button type="submit" class="btn btn-lg btn-success">Login</button> </form> </div> </div> <br> </div> <div class="col-md-6"> <div class="panel panel-default" style="height: 305px"> <div class="panel-heading">- OR -</div> <div class="panel-body"> <br> <br> <button data-ng-click="goLoginGuess();" style="font-size: 26pt" class="btn btn-lg btn-success">Connect Guest</button> <br> <br> </div> </div> </div> <div class="col-md-12"> <p> <span class="hidden-sm hidden-md hidden-lg"> <br> <br> </span> You don\'t have an account ? <br> <button class="btn btn-danger" data-ui-sref="register">Register</button> </p> </div> </div> </div>'),a.put("views/register.html",'<div id="register" class="container"> <div class="col-md-offset-3 col-md-6 text-center"> <h1 class="title-uno"> <span class="color-orange">U</span><span class="color-rouge">N</span><span class="color-vert">O</span> </h1> <br> <div class="col-md-12"> <div class="panel panel-default"> <div class="panel-heading">Register</div> <div class="panel-body"> <form method="post" class="form-horizontal" data-ng-submit="goRegister()"> <div class="form-group"> <input class="input-form input-lg" type="text" placeholder="Prénom" id="prenom" data-ng-model="prenom"> </div> <div class="form-group"> <input class="input-form input-lg" type="email" placeholder="Email" id="email" data-ng-model="email"> </div> <div class="form-group"> <input class="input-form input-lg" type="password" placeholder="Password" id="pass" data-ng-model="pass"> </div> <br> <button type="submit" class="btn btn-lg btn-success">Register</button> </form> </div> </div> </div> <br> <p> You already have an account ? <br> <button class="btn btn-danger" data-ui-sref="login">Login</button> </p> </div> </div>'),a.put("views/room.html",'<div class="col-md-12 text-center" style="padding-bottom: 15px"> <h1 class="title">Room {{gameName}}</h1> <br> <button data-ng-if="game.players.length == game.maxplayers && game.host == user.name" class="btn btn-success btn-lg" data-ng-click="startGameNow()">Start game now</button> <br> </div> <div class="col-md-10 col-md-offset-1"> <div class="panel panel-default"> <div class="panel-heading"> Waiting for players... <span style="float: right">{{game.players.length}}/{{game.maxplayers}} joined</span> </div> <div class="panel-body" style="padding: 0"> <table class="table"> <tr data-ng-repeat="player in game.players"> <td width="15"> <i data-ng-if="game.host == player.name" class="fa fa-bookmark-o" style="color: #f55; font-weight: bolder"></i> <i data-ng-if="game.host != player.name" class="fa fa-child" style="color: #fa0"></i> </td> <td class="text-center">{{player.name}} join the game</td> </tr> </table> </div> </div> </div>'),a.put("views/start.html",'<div id="start" class="container"> <div class="col-md-offset-3 col-md-6 text-center"> <div data-ng-if="error" class="alert alert-danger"> {{error}} </div> <h1 class="title-uno">Game configuration</h1> <br> <div class="panel panel-default"> <div class="panel-body"> <form class="form-horizontal" data-ng-submit="goGame()"> <div class="form-group"> <label for="username" class="col-md-4 control-label">Game name</label> <div class="col-md-8"> <input id="username" class="form-control input-lg" type="text" data-ng-model="game" placeholder="Game name"> </div> </div> <hr style="border-color: rgba(0, 0, 0, 0.2)"> <div class="form-group"> <label for="nbPlayers" class="col-md-4 control-label">Number players</label> <div class="col-md-8"> <select class="form-control input-lg" name="nbPlayers" data-ng-model="nbPlayers" id="nbPlayers"> <option value="2">2</option> <option value="3">3</option> <option value="4">4</option> <option value="5">5</option> <option value="6">6</option> </select> </div> </div> <br> <br> <button type="submit" class="btn btn-lg btn-success" style="font-size: 24pt">GO !</button> </form> </div> </div> <br> </div> </div>'),a.put("views/struct/footer.html","<span> By LP SIL IDSE </span>"),a.put("views/struct/header.html",'<nav class="navbar"> <div class="container-fluid"> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-toggle" aria-expanded="false"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href data-ui-sref="app.home"> <span class="color-orange">U</span><span class="color-rouge">N</span><span class="color-vert">O</span> </a> </div> <div class="collapse navbar-collapse" id="navbar-toggle"> <ul class="nav navbar-nav navbar-right"> <li> {{user.name}} </li> <li> <a href data-ng-click="goLogout()"> <i class="fa fa-sign-out"></i> </a> </li> </ul> </div> </div> </nav>')}]);